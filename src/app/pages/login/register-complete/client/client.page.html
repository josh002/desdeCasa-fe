<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button color="primary"></ion-back-button>
        </ion-buttons>
        <ion-title>Registro Usuario</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content fullscreen>
    <form #myForm="ngForm" (ngSubmit)="onSubmit(myForm)">

        <ion-content fullscreen>
            <ion-list>

                <!-- Mail -->
                <ion-item>
                    <ion-label color="primary" autocomplete="off" position="floating">Direccion de correo
                        electrónico
                    </ion-label>
                    <ion-input name="email" #email="ngModel" type="email" [(ngModel)]="client.email" required
                        pattern="[A-Za-z0-9._%+-]{2,}@[a-zA-Z0-9-_.]{2,}[.]{1}[a-zA-Z]{2,}[ ]?">
                    </ion-input>
                </ion-item>
                <ng-container *ngIf="email.invalid && ((email.dirty && email.touched) || desperationLevel > 3)">
                    <div class="ux-alert" lines="none" *ngIf="email.errors && email.errors.required">
                        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                        <ion-label>Campo Requerido</ion-label>
                    </div>
                    <div class="ux-alert" lines="none" *ngIf="email.errors && email.errors.pattern">
                        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                        <ion-label>No parece ser una dirección válida</ion-label>
                    </div>
                </ng-container>

                <!-- Contraseña -->
                <ion-item>
                    <ion-label color="primary" position="floating">Contraseña</ion-label>
                    <ion-input name="password" #password="ngModel" minlength="4" type="password"
                        pattern="[A-Za-z0-9._-]+" [(ngModel)]="client.password" required>
                    </ion-input>
                </ion-item>
                <ng-container
                    *ngIf="password.invalid && ((password.dirty && password.touched) || desperationLevel > 3)">
                    <div class="ux-alert" lines="none" *ngIf="password.errors && password.errors.required">
                        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                        <ion-label>Campo Requerido</ion-label>
                    </div>
                    <div class="ux-alert" lines="none" *ngIf="password.errors && password.errors.minlength">
                        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                        <ion-label>4 caracteres de longitud mínima</ion-label>
                    </div>
                    <div class="ux-alert" lines="none" *ngIf="password.errors && password.errors.pattern">
                        <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                        <ion-label>Solo letras, números, guiones y puntos</ion-label>
                    </div>
                </ng-container>
            </ion-list>

            <!-- Nombre -->
            <ion-item>
                <ion-label color="primary" position="floating">Nombre</ion-label>
                <ion-input name="firstName" #firstName="ngModel" type="text" [(ngModel)]="client.firstName"
                    pattern="[A-Za-zäÄëËïÏöÖüÜáéíóúáéíóúÁÉÍÓÚÂÊÎÔÛâêîôûàèìòùÀÈÌÒÙñÑ]+([ ][A-Za-zäÄëËïÏöÖüÜáéíóúáéíóúÁÉÍÓÚÂÊÎÔÛâêîôûàèìòùÀÈÌÒÙñÑ]+){0,}[ ]?"
                    required>
                </ion-input>
            </ion-item>
            <ng-container *ngIf="firstName.invalid && ((firstName.dirty && firstName.touched) || desperationLevel > 3)">
                <div class="ux-alert" lines="none" *ngIf="firstName.errors && firstName.errors.required">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Campo Requerido</ion-label>
                </div>
                <div class="ux-alert" lines="none" *ngIf="firstName.errors && firstName.errors.pattern">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Solo letras y espacios</ion-label>
                </div>
            </ng-container>

            <!-- Apellido -->
            <ion-item>
                <ion-label color="primary" position="floating">Apellido</ion-label>
                <ion-input name="lastName" #lastName="ngModel" type="text" [(ngModel)]="client.lastName"
                    pattern="[A-Za-zäÄëËïÏöÖüÜáéíóúáéíóúÁÉÍÓÚÂÊÎÔÛâêîôûàèìòùÀÈÌÒÙñÑ]+([ ][A-Za-zäÄëËïÏöÖüÜáéíóúáéíóúÁÉÍÓÚÂÊÎÔÛâêîôûàèìòùÀÈÌÒÙñÑ]+){0,}[ ]?"
                    required>
                </ion-input>
            </ion-item>
            <ng-container *ngIf="lastName.invalid && ((lastName.dirty && lastName.touched) || desperationLevel > 3)">
                <div class="ux-alert" lines="none" *ngIf="lastName.errors && lastName.errors.required">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Campo Requerido</ion-label>
                </div>
                <div class="ux-alert" lines="none" *ngIf="lastName.errors && lastName.errors.pattern">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Solo letras y espacios</ion-label>
                </div>
            </ng-container>

            <!-- DNI -->
            <ion-item>
                <ion-label color="primary" position="floating">DNI</ion-label>
                <ion-input name="dni" #dni="ngModel" type="text" minlength="7" maxlength="8" pattern="[0-9]+"
                    [(ngModel)]="client.dni" required>
                </ion-input>
            </ion-item>
            <ng-container *ngIf="dni.invalid && ((dni.dirty && dni.touched) || desperationLevel > 3)">
                <div class="ux-alert" lines="none" *ngIf="dni.errors && dni.errors.required">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Campo Requerido</ion-label>
                </div>
                <div class="ux-alert" lines="none" *ngIf="dni.errors && (dni.errors.minlength || dni.errors.maxlength)">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Número no válido</ion-label>
                </div>
                <div class="ux-alert" lines="none" *ngIf="dni.errors && dni.errors.pattern">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Sólo números sin puntos ni guiones</ion-label>
                </div>
            </ng-container>

            <!-- Provincia      -->
            <ion-item>
                <ion-label position="floating" color="primary">Provincia</ion-label>
                <ion-select name="province" #province="ngModel" [(ngModel)]="selectedProvinceName"
                    (ionChange)=onProvinceChange() required>
                    <ion-select-option *ngFor="let province of provinces" [(value)]="province.nombre">
                        {{province.nombre | titlecase}}
                    </ion-select-option>
                </ion-select>
            </ion-item>
            <ng-container *ngIf="province.invalid && (province.touched || desperationLevel > 3)">
                <div class="ux-alert" lines="none" *ngIf="province.errors && province.errors.required">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Campo Requerido</ion-label>
                </div>
            </ng-container>

            <!-- Departamento      -->
            <ion-item>
                <ion-label position="floating" color="primary">Departamento</ion-label>
                <ion-select name="department" #department="ngModel" [disabled]="!selectedProvince"
                    (ionChange)=onDepartmentChange() [(ngModel)]="selectedDepartmentName" required>
                    <ion-select-option *ngFor="let department of departments" [(value)]="department.nombre">
                        {{department.nombre | titlecase}}
                    </ion-select-option>
                </ion-select>
            </ion-item>
            <ng-container *ngIf="department.invalid && (department.touched || desperationLevel > 3)">
                <div class="ux-alert" lines="none" *ngIf="department.errors && department.errors.required">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Campo Requerido</ion-label>
                </div>
            </ng-container>

            <!-- Dirección -->
            <ion-item>
                <ion-label color="primary" position="floating">Direccion</ion-label>
                <!-- <ion-input name="address" #address="ngModel" type="text" (ionFocus)="addressHelper()" [disabled]="!selectedDepartment" [(ngModel)]="client.address" required> -->
                <ion-input name="address" #address="ngModel" type="text" [disabled]="!selectedDepartment"
                    [(ngModel)]="client.address" required>
                </ion-input>
            </ion-item>
            <ng-container *ngIf="address.pristine">
                <div class="ux-alert" lines="none">
                    <ion-icon slot="start" name="warning"></ion-icon>
                    <ion-label>{{addressInputHelperText}}</ion-label>
                </div>
            </ng-container>
            <ng-container *ngIf="address.invalid && ((address.dirty && address.touched) || desperationLevel > 3)">
                <div class="ux-alert" lines="none" *ngIf="address.errors && address.errors.required">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Campo Requerido</ion-label>
                </div>
            </ng-container>

            <!-- Submit Button -->
            <div class="ion-padding" (click)=desperateUser()>
                <ion-button type="ngSubmit" color="primary" shape="round" expand="block"
                    [disabled]="myForm.form.invalid">
                    <ion-label color="light">Crear cuenta</ion-label>
                </ion-button>
                <div class="button-helper" lines="none" *ngIf="desperationLevel > 3">
                    <ion-icon slot="start" name="information-circle-outline"></ion-icon>
                    <ion-label>Revise si le quedaron campos sin completar</ion-label>
                </div>
            </div>
        </ion-content>
    </form>
</ion-content>